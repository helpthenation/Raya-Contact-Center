<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

      <record model="ir.ui.view" id="view_hr_evaluation_plan_search">
            <field name="name">hr_evaluation.plan.search</field>
            <field name="model">hr_evaluation.plan</field>
            <field name="arch" type="xml">
                <search string="Appraisal Plan">
                   <field name="name" string="Appraisal Plans"/>
                   <field name="company_id"/>
                   <group expand="0" string="Group By" groups="base.group_multi_company">
                        <filter name="Company" domain="[]" context="{'group_by':'company_id'}"/>
                    </group>
               </search>
            </field>
        </record>

        <record model="ir.ui.view" id="view_hr_evaluation_plan_form">
            <field name="name">hr_evaluation.plan.form</field>
            <field name="model">hr_evaluation.plan</field>
            <field name="arch" type="xml">
                <form string="Appraisal Plan">
                    <sheet>
                        <group>
                            <group>
                                <field name="name"/>
                                <field name="company_id" widget="selection" groups="base.group_multi_company"/>
                            </group>
                            <group>
                            </group>
                        </group>
                        <notebook>
                            <page string="Appraisal Phases">
                                <field name="phase_ids"/>
                            </page>
                        </notebook>
                    </sheet>
                </form>
            </field>
        </record>

        <record model="ir.ui.view" id="view_hr_evaluation_plan_tree">
            <field name="name">hr_evaluation.plan.form</field>
            <field name="model">hr_evaluation.plan</field>
            <field name="arch" type="xml">
                <tree string="Appraisal Plan">
                    <field name="name"/>
                </tree>
            </field>
        </record>

        <record model="ir.actions.act_window" id="open_view_hr_evaluation_plan_tree">
            <field name="name">Appraisal Plans</field>
            <field name="res_model">hr_evaluation.plan</field>
            <field name="view_mode">tree,form</field>
        </record>

      <!-- Appraisal Interviews Action -->

        <record id="act_hr_employee_2_hr__evaluation_interview" model="ir.actions.act_window">
            <field name="res_model">hr.evaluation.interview</field>
            <field name="name">Interviews</field>
            <field name="view_mode">tree,form</field>
            <field name="context">{'search_default_user_to_review_id': [active_id], 'default_user_to_review_id': active_id}</field>
        </record>

        <record model="ir.ui.view" id="view_hr_evaluation_plan_phase_form">
            <field name="name">hr_evaluation.plan.phase.form</field>
            <field name="model">hr_evaluation.plan.phase</field>
            <field name="arch" type="xml">
                <form string="Appraisal Plan Phases">
                 <notebook>
                   <page string="General">
                    <field name="plan_id" invisible="1"/>
                        <group>
                            <group>
                                <field name="name"/>
                                <field name="wait"/>
                                <field name="sequence"/>
                            </group>
                            <group>
                                <field name="action"/>
                                <field name="survey_id"/>
                            </group>
                        </group>
                    </page>
                    <page string="Mail Settings">
                        <group string="Legend">
                        </group>
                    </page>
                  </notebook>
                </form>
            </field>
        </record>

         <record model="ir.ui.view" id="view_hr_evaluation_plan_phase_tree">
            <field name="name">hr_evaluation.plan.phase.form</field>
            <field name="model">hr_evaluation.plan.phase</field>
            <field name="arch" type="xml">
                <tree string="Appraisal Plan Phases" editable="bottom" >
                    <field name="sequence" widget="handle"/>
                    <field name="name"/>
                    <field name="action"/>
                    <field name="survey_id"/>
                    <field name="wait"/>
                </tree>
            </field>
        </record>

        <record id="hr_hr_employee_view_form" model="ir.ui.view">
            <field name="name">hr.hr.employee.view.form</field>
            <field name="model">hr.employee</field>
            <field name="inherit_id" ref="hr.view_employee_form"/>
            <field name="arch" type="xml">
            <xpath expr="//group[@name='active_group']" position="before">
                <group string="Appraisals">
                    <field name="evaluation_plan_id"/>
                    <field name="evaluation_date"/>
                </group>
            </xpath>
            <xpath expr="//div[@name='button_box']" position="inside">
                <button name="%(act_hr_employee_2_hr__evaluation_interview)d"
                    class="oe_stat_button"
                    icon="fa-sitemap"
                    type="action">
                    <field name="appraisal_count" widget="statinfo" string="Appraisals"/>
                </button>
            </xpath>
            </field>
        </record>

        <record model="ir.ui.view" id="view_hr_evaluation_form">
            <field name="name">hr_evaluation.evaluation.form</field>
            <field name="model">hr_evaluation.evaluation</field>
            <field name="arch" type="xml">
                <form string="Appraisals">
                <header>
                    <button name="button_plan_in_progress" string="Start Appraisal" states="draft" type="object" class="oe_highlight"/>
                    <button name="button_final_validation" string="Validate Appraisal" states="wait" type="object" class="oe_highlight"/>
                    <button name="%(odoo_hr_evaluation.action_create_next_appraisal_date)d" string="Done" states="progress" type="action" class="oe_highlight"/>
                    <button name="button_draft" string="Reset to Draft" states="cancel" type="object" />
                    <button name="button_cancel" string="Cancel Appraisal" states="draft,wait,progress" type="object"/>
                    <field name="state" widget="statusbar" statusbar_visible="draft,progress,wait,done" statusbar_colors='{"progress":"blue"}'/>
                </header>
                <sheet>
                    <label for="employee_id" class="oe_edit_only"/>
                    <h1>
                        <field name="employee_id" class="oe_inline" attrs="{'readonly': [('state', '=', 'done')]}" on_change="onchange_employee_id(employee_id)"/>
                    </h1>
                    <label for="plan_id" class="oe_edit_only"/>
                    <h2><field name="plan_id" attrs="{'readonly': [('state', '=', 'done')]}"/></h2>
                    <group>
                        <field name="date" attrs="{'readonly': [('state', '=', 'done')]}"/>
                        <group colspan="4" attrs="{'invisible':['|', ('state','=','draft'), ('state', '=', 'wait')]}">
                            <field name="rating" attrs="{'readonly':[('state','&lt;&gt;','progress')]}"/>
                            <field name="date_close" readonly="1"/>
                        </group>

                        <group>
                            <field name="company_id"/> <!--ODOO13-->
                            <field name="evaluation_officer_id"/>
                        </group>
                    </group>
                    <group string="Appraisal Forms" attrs="{'invisible':[('state','=','draft')]}"/>
                    <field nolabel="1" name="survey_request_ids" attrs="{'invisible': [('state','=','draft')], 'readonly': [('state', '=', 'done')]}" />
<!--                    </group> REMOVE DUE TO VISIBILITY ISSUE 13-->
                    <group string="Internal Notes" attrs="{'invisible':[('state','=','draft')]}">
                        <field nolabel="1" name="note_action"
                            groups="base.group_hr_manager" placeholder="Appraisal Summary..."/>
                    </group>
                    <group string="Public Notes" attrs="{'invisible':[('state','=','draft')]}">
                        <field nolabel="1" name="note_summary" placeholder="Action Plan..."/>
                    </group>
              </sheet>
              <div class="oe_chatter">
                  <field name="message_follower_ids" widget="mail_followers"/>
                  <field name="message_ids" widget="mail_thread"/>
              </div>
              </form>
            </field>
        </record>

        <record model="ir.ui.view" id="view_hr_evaluation_tree">
            <field name="name">hr_evaluation.evaluation.tree</field>
            <field name="model">hr_evaluation.evaluation</field>
            <field name="arch" type="xml">
                <tree string="Appraisal">
                    <field name="employee_id"/>
                    <field name="plan_id"/>
                    <field name="date"/>
                    <field name="rating"/>
                    <field name="state"/>
                </tree>
            </field>
        </record>

      <record id="odoo_hr_evaluation.evaluation_search" model="ir.ui.view">
            <field name="name">hr_evaluation.evaluation_search</field>
            <field name="model">hr_evaluation.evaluation</field>
            <field name="arch" type="xml">
                <search string="Search Appraisal">
                    <field name="date"/>
                    <filter name="Pending" domain="[('state','=','wait')]" help="Appraisal that are in Plan In Progress state"/>
                    <filter name="In progress" domain="[('state','=','progress')]" help="Appraisal that are in waiting appreciation state"/>
                    <field name="employee_id" />
                    <field name="plan_id"/>
                    <group expand='0' string='Group by...'>
                        <filter name='Employee' domain="[]" context="{'group_by' : 'employee_id'}" />
                        <filter name='Plan' domain="[]" context="{'group_by' : 'plan_id'}" />
                        <filter name='Status' domain="[]" context="{'group_by' : 'state'}" />
                        <filter name='Appraisals Month' domain="[]" context="{'group_by' : 'date'}" help="Appraisals by Month" />
                   </group>
               </search>
            </field>
        </record>


        <record model="ir.actions.act_window" id="open_view_hr_evaluation_tree">
            <field name="name">Appraisal</field>
            <field name="res_model">hr_evaluation.evaluation</field>
            <field name="view_mode">tree,form</field>
            <field name="search_view_id" ref="odoo_hr_evaluation.evaluation_search"/>
             <field name="context">{"search_default_next_month":1}</field>
            <field name="help" type="html">
              <p class="oe_view_nocontent_create">
                Click to create a new appraisal.
              </p><p>
                Each employee may be assigned an Appraisal Plan. Such a plan
                defines the frequency and the way you manage your periodic
                personnel evaluation. You will be able to define steps and
                attach interviews to each step. Odoo manages all kinds of
                evaluations: bottom-up, top-down, self-evaluation and final
                evaluation by the manager.
              </p>
            </field>
        </record>

         <record model="ir.ui.view" id="view_hr_evaluation_interview_form">
            <field name="name">hr_evaluation.interview.form</field>
            <field name="model">hr.evaluation.interview</field>
            <field name="arch" type="xml">
                <form string="Interview Appraisal">
                    <header>
                        <button string="Cancel Survey" name="survey_req_cancel" type="object"
                            states="draft,waiting_answer" class="oe_left"/>
                        <button string="Print Survey" name="action_print_survey" type="object" states='waiting_answer,done' attrs="{'readonly':[('survey_id','=',False)]}"/>
                        <button string="Send Request" name="survey_req_waiting_answer" type="object"
                            states="draft" class="oe_highlight"/>
                        <button string="Answer Survey" class="oe_highlight" name="action_start_survey" type="object" states='waiting_answer' attrs="{'readonly':[('request_id','=',False)]}"/>
                        <button string="Done" name="survey_req_done" type="object"
                            states="waiting_answer"/>
                        <field name="state" widget="statusbar" statusbar_visible="waiting_answer,done"/>
                    </header>
                    <sheet>

                        <div class="oe_button_box" name="button_box">
                        </div>
                        <group>
                            <group>
                                <field name="evaluation_id" string="Appraisal"/>
                                <field name="phase_id"/>
                                <field name="user_to_review_id" readonly="1"/>
                            </group>
                            <group>
                                <field name="user_id" string="Interviewer" context="{'default_groups_ref': ['base.group_user', 'base.group_partner_manager', 'base.group_hr_manager']}"/>
                                <field name="deadline"/>
                            </group>
                            <group>
                                <field name="request_id"/>
                                <field name="survey_id" readonly="1"/>
                                <field name="interview_seq"/> <!-- ODOO13 -->
                            </group>
                            <group>
                                <field name="company_id"/> <!--ODOO13-->
                            </group>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>

          <record model="ir.ui.view" id="view_hr_evaluation_interview_tree">
            <field name="name">hr_evaluation.interview.tree</field>
            <field name="model">hr.evaluation.interview</field>
            <field name="arch" type="xml">
                <tree string="Interview Appraisal">
                    <field name="deadline" string="Deadline Date"/>
                    <field name="survey_id" />
                    <field name="user_id" string="Interviewer"/>
                    <field name="user_to_review_id"/>
                    <field name="request_id" readonly="1" invisible="True"/>
                    <button name="action_start_survey" string="Answer Survey" type="object"  class="fa fa-cog oe_highlight" attrs="{'readonly':[('request_id','=',False)]}"/>
                    <button name="action_print_survey" string="Print Survey" type="object" class="fa fa-print oe_highlight"  attrs="{'readonly':[('survey_id','=',False)]}"/>
                    <field name="state"/>
                    <button string="Send Request" name="survey_req_waiting_answer" states="draft" type="object" class="fa fa-check oe_highlight" />
                    <button string="Done" name="survey_req_done" states="waiting_answer" type="object" class="fa fa-arrow-up oe_highlight" />
                </tree>
            </field>
        </record>

       <record id="view_hr_evaluation_interview_search" model="ir.ui.view">
            <field name="name">view_hr_evaluation_interview_search</field>
            <field name="model">hr.evaluation.interview</field>
            <field name="arch" type="xml">
                <search string="Search Appraisal">
                    <field name="deadline"/>
                    <filter name="To Do" domain="[('state','=','waiting_answer')]"/>
                    <field name="user_to_review_id"/>
                    <field name="user_id" string="Interviewer"/>
                    <group expand="0" string="Group By">
                        <filter name="Interviewer" domain="[]" context="{'group_by':'user_id'}"/>
                        <filter name="Status" domain="[]" context="{'group_by':'state'}"/>
                    </group>
               </search>
            </field>
        </record>

        <record id="view_evaluation_calendar" model="ir.ui.view">
            <field name="name">Interview Requests</field>
            <field name="model">hr.evaluation.interview</field>
            <field name="arch" type="xml">
                <calendar string="Interview Request" color="user_to_review_id" date_start="deadline">
                    <field name="request_id"/>
                </calendar>
            </field>
        </record>

        <record model="ir.actions.act_window" id="action_hr_evaluation_interview_tree">
            <field name="name">Interview Requests</field>
            <field name="res_model">hr.evaluation.interview</field>
            <field name="view_id" eval="False"/>
            <field name="domain" eval="False"/> <!-- <!- Force empty -->
            <field name="context">{"search_default_todo":1,"search_default_user_id":uid}</field>
            <field name="search_view_id" ref="view_hr_evaluation_interview_search"/>
            <field name="help" type="html">
              <p class="oe_view_nocontent_create">
                Click to create a new interview request related to a personal evaluation.
              </p><p>
                Interview requests are usually generated automatically by
                Odoo according to an employee's appraisal plan. Each user
                receives automatic emails and requests to evaluate their
                colleagues periodically.
              </p>
            </field>
        </record>

        <record model="ir.actions.act_window.view" id="hr_evaluation_interview_tree">
            <field name="sequence" eval="1"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="view_hr_evaluation_interview_tree"/>
            <field name="act_window_id" ref="action_hr_evaluation_interview_tree"/>
        </record>
        <record model="ir.actions.act_window.view" id="hr_evaluation_interview_form">
            <field name="sequence" eval="2"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="view_hr_evaluation_interview_form"/>
            <field name="act_window_id" ref="action_hr_evaluation_interview_tree"/>
        </record>
        <record model="ir.actions.act_window.view" id="action_view_evaluation_calendar">
            <field name="sequence" eval="3"/>
            <field name="view_mode">calendar</field>
            <field name="view_id" ref="view_evaluation_calendar"/>
            <field name="act_window_id" ref="action_hr_evaluation_interview_tree"/>
        </record>
        <menuitem
            id="menu_hr_evaluation"
            name="Evaluation"
            groups="base.group_user"/>

        <menuitem name="Appraisal" parent="odoo_hr_evaluation.menu_hr_evaluation" id="menu_eval_hr" sequence="1"/>
        <menuitem name="Appraisals" parent="menu_eval_hr" id="menu_open_view_hr_evaluation_tree"
            action="open_view_hr_evaluation_tree" groups="odoo_hr_evaluation.grp_evalution_user"/>
        <menuitem name="Interview Requests" parent="menu_eval_hr" id="menu_open_hr_evaluation_interview_requests"
            action="action_hr_evaluation_interview_tree"/>

        <menuitem
            id="menu_human_resources_configuration_hr_evaluation"
            name="Configuration"
            parent="menu_hr_evaluation"
            groups="odoo_hr_evaluation.grp_evalution_manager"
            sequence="10"/>

        <menuitem parent="odoo_hr_evaluation.menu_human_resources_configuration_hr_evaluation" id="menu_open_view_hr_evaluation_plan_tree"
            action="open_view_hr_evaluation_plan_tree"/>


    </data>
</odoo>
