<?xml version="1.0" encoding="utf-8"?>
<odoo>

<!-- Page -->
<template id="layout" name="Partners Layout">
    <t t-call="website.layout">
        <t t-set="additional_title">Resellers</t>
        <div id="wrap">
            <div class="oe_structure" id="oe_structure_website_crm_partner_assign_layout_1"/>
            <div class="container mt16">
                <div class="row">
                    <t t-raw="ref_content" />
                </div>
            </div>
            <div class="oe_structure" id="oe_structure_website_crm_partner_assign_layout_2"/>
        </div>
    </t>
</template>

<template id="index" name="Find Resellers">
    <t t-call="website_partner_rating.layout">
        <t t-set="ref_content">
            <div class="col-lg-12">
                <h1 class="text-center">
                    Looking For a Local Store?
                </h1><h2 class="text-center text-muted">
                    Contact a reseller
                </h2>
            </div>

            <div class="col-lg-3 mb32" id="partner_left">

                <ul id="reseller_grades" class="nav nav-pills flex-column mt16">
                    <li class="nav-header nav-item"><h3>Filter by Level</h3></li>
                    <t t-foreach="grades" t-as="grade">
                        <li class="nav-item">
                            <a t-attf-href="/partners#{ grade['grade_id'][0] and '/grade/%s' % grade['grade_id'][0] or '' }#{ current_country and '/country/%s' % slug(current_country) or '' }#{ '?' + (search_path or '') + '&amp;' + keep_query('country_all') }"
                               t-attf-class="nav-link#{grade['active'] and ' active' or ''}">
                                <span class="badge badge-pill float-right" t-esc="grade['grade_id_count'] or ''"/>
                                <t t-esc="grade['grade_id'][1]"/>
                            </a>
                        </li>
                    </t>
                </ul>

                <ul id="reseller_countries" class="nav nav-pills flex-column mt16">
                    <li class="nav-header nav-item"><h3>Filter by Country</h3></li>
                    <t t-foreach="countries" t-as="country">
                        <li t-if="country['country_id']" class="nav-item">
                            <a t-attf-href="/partners#{ current_grade and '/grade/%s' % slug(current_grade) or ''}#{country['country_id'][0] and '/country/%s' % country['country_id'][0] or '' }#{ '?' + (search_path or '') + (country['country_id'][0] == 0 and '&amp;country_all=True' or '')}"
                               t-attf-class="nav-link#{country['active'] and ' active' or ''}">
                                <span class="badge badge-pill float-right" t-esc="country['country_id_count'] or ''"/>
                                <t t-esc="country['country_id'][1]"/>
                            </a>
                        </li>
                    </t>
                </ul>

            </div>

            <div class="col-lg-8 offset-lg-1" id="ref_content">
                <div class="d-flex p-2">
                    <t t-call="website.pager"/>
                    <form action="" method="get" class="form-inline ml-auto">
                        <div class="form-group">
                            <input t-if="country_all" type="hidden" name="country_all" value="True" />
                            <input type="text" name="search" class="search-query form-control" placeholder="Search" t-att-value="searches.get('search', '')"/>
                        </div>
                    </form>
                </div>
                <div>
                    <p t-if="not partners">No result found</p>
                    <t t-foreach="partners" t-as="partner">
                        <t t-if="last_grade != partner.grade_id.id">
                            <h3 class="text-center mt-4">
                                <span t-field="partner.grade_id"/> Partners
                                <t t-call="website.publish_management">
                                    <t t-set="object" t-value="partner.grade_id"/>
                                    <t t-set="publish_edit" t-value="True"/>
                                </t>
                            </h3>
                            <t t-set="last_grade" t-value="partner.grade_id.id"/>
                        </t>
                        <div class="media mt-3">
                            <a t-attf-href="/partners/#{slug(partner)}?#{current_grade and 'grade_id=%s&amp;' % current_grade.id}#{current_country and 'country_id=%s' % current_country.id}"
                               t-field="partner.image_128"
                               class="mr-3 text-center o_width_128"
                               t-options='{"widget": "image", "qweb_img_responsive": False, "class": "o_image_128_max"}'
                            ></a>
                            <div class="media-body o_partner_body" style="min-height: 64px;">
                                <a t-attf-href="/partners/#{slug(partner)}?#{current_grade and 'grade_id=%s&amp;' % current_grade.id}#{current_country and 'country_id=%s' % current_country.id}">
                                    <span t-field="partner.display_name"/>
                                </a>
                                <div t-field="partner.website_short_description"/>
                                <t t-if="any(p.website_published for p in partner.implemented_partner_ids)">
                                    <small><a t-attf-href="/partners/#{slug(partner)}#right_column">
                                        <t t-esc="partner.implemented_count"/> reference(s)
                                    </a></small>
                                </t>
                            </div>
                        </div>
                    </t>
                </div>
                <div class='navbar'>
                    <t t-call="website.pager">
                       <t t-set="classname" t-valuef="float-left"/>
                    </t>
                </div>
            </div>
        </t>
    </t>
</template>

<template id="ref_country" inherit_id="website_partner_rating.index" customize_show="True" name="Left World Map">
    <xpath expr="//ul[@id='reseller_countries']" position="after">
        <t t-if="google_maps_api_key">
            <!-- modal for large map -->
            <div role="dialog" class="modal fade partner_map_modal" tabindex="-1">
              <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <header class="modal-header">
                        <h4 class="modal-title">World Map</h4>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">Ã—</button>
                    </header>
                    <iframe t-attf-src="/google_map/?width=898&amp;height=485&amp;partner_ids=#{ google_map_partner_ids }&amp;partner_url=/partners/"
                    style="width:898px; height:485px; border:0; padding:0; margin:0;"></iframe>
                </div>
              </div>
            </div>
            <!-- modal end -->
            <h3>World Map<button class="btn btn-link" data-toggle="modal" data-target=".partner_map_modal"><span class="fa fa-external-link" role="img" aria-label="External link" title="External link"/></button></h3>
            <ul class="nav">
                <iframe t-attf-src="/google_map?width=260&amp;height=240&amp;partner_ids=#{ google_map_partner_ids }&amp;partner_url=/partners/"
                    style="width:260px; height:240px; border:0; padding:0; margin:0;" scrolling="no"></iframe>
            </ul>
        </t>
    </xpath>
</template>

<template id="partner" name="Partner Detail">
    <t t-call="website_partner_rating.layout">
        <t t-set="ref_content">
            <div class="col-lg-5">
                <ol t-if="not edit_page" class="breadcrumb">
                    <li class="breadcrumb-item"><a t-attf-href="/partners#{current_grade and '/grade/%s' % slug(current_grade)}#{current_country and '/country/%s' % slug(current_country)}">Our Partners</a></li>
                    <li class="breadcrumb-item active"><span t-field="partner.display_name"/></li>
                </ol>
            </div>
            <t t-call="website_partner.partner_detail">
                <t t-set="right_column">
                    <div id="right_column" class="mb16"><t t-call="website_partner_rating.references_block"/></div>
                </t>
            </t>
        </t>
    </t>
</template>

<template id="grade_in_detail" inherit_id="website_partner.partner_detail">
  <xpath expr="//*[@id='partner_name']" position="after">
    <h3 class="col-lg-12 text-center text-muted" t-if="partner.grade_id and partner.grade_id.website_published">
      <span t-field="partner.grade_id"/> Partner</h3>
  </xpath>
</template>

<template id="references_block" name="Partner References Block">
    <t t-if="any(p.website_published for p in partner.implemented_partner_ids)">
        <h3 id="references">References</h3>
        <div t-foreach="partner.implemented_partner_ids" t-if="reference.website_published" t-as="reference" class="media mt-3">
            <span t-field="reference.image_128" class="d-block mr-3 text-center o_width_128" t-options='{"widget": "image", "qweb_img_responsive": False, "class": "o_image_128_max"}'/>
            <div class="media-body" style="min-height: 64px;">
                <span t-field="reference.self"/>
                <div t-field='reference.website_short_description'/>
            </div>
        </div>
    </t>
</template>

<!-- Portal -->
    <template id="assets_frontend" inherit_id="website.assets_frontend" name="Survey assets">
        <xpath expr="." position="inside">
            <script type="text/javascript" src="/website_partner_rating/static/src/js/crm_partner_assign.js" />
        </xpath>
    </template>
</odoo>
